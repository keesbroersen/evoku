import{ao as le,r as M,Z as re,ar as de,ap as te,C as B,aq as ce,aW as fe,D as W,h as A,w as $,e as L,E as oe,J as g,at as z,aT as N,P as ue,aL as ve,aU as U,aV as pe,I as he,aX as ae,B as me,x as ge,L as ye,ax as be,c as P,f as O,n as w,am as xe,F as ne,G as ke,d as se,M as Ce,t as Te}from"./6Rn4nlWm.js";import{c as Ie}from"./C14Csw1P.js";import{t as ie}from"./D2znOvIs.js";import Ee from"./BTUB_f5Q.js";import{_ as Se,M as Ke}from"./xVhrRl9I.js";import{u as _e}from"./Bdf2Z3Ka.js";import{u as we}from"./CFJHiWRE.js";import{_ as Ae}from"./CSN7FqSU.js";import"./cFSsJp-w.js";function G(o,i,l){const v=o.findIndex(h=>le(h,i)),S=o.findIndex(h=>le(h,l));if(v===-1||S===-1)return[];const[a,p]=[v,S].sort((h,u)=>h-u);return o.slice(a,p+1)}function j(o){return o.reduce((i,l)=>(i.push(l),l.children&&i.push(...j(l.children)),i),[])}function Be(o,i){const l=M(),v=(a,p)=>{if(i.multiple&&Array.isArray(o.value))if(i.selectionBehavior==="replace")o.value=[a],l.value=a;else{const h=o.value.findIndex(u=>p(u));h!==-1?o.value=o.value.filter((u,C)=>C!==h):o.value=[...o.value,a]}else i.selectionBehavior==="replace"?o.value={...a}:!Array.isArray(o.value)&&p(o.value)?o.value=void 0:o.value={...a};return o.value};function S(a,p,h,u){var K;if(!(l!=null&&l.value)||!i.multiple||!Array.isArray(o.value))return;const E=(K=h().filter(_=>_.ref.dataset.disabled!=="").find(_=>_.ref===p))==null?void 0:K.value;if(!E)return;let T=null;switch(a){case"prev":case"next":{T=G(u,l.value,E);break}case"first":{T=G(u,l.value,u==null?void 0:u[0]);break}case"last":{T=G(u,l.value,u==null?void 0:u[u.length-1]);break}}o.value=T}return{firstValue:l,onSelectItem:v,handleMultipleReplace:S}}const[Le,Re]=ce("TreeRoot"),$e=re({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:o=>o.children},selectionBehavior:{default:"toggle"},multiple:{type:Boolean},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(o,{emit:i}){const l=o,v=i,{items:S,multiple:a,disabled:p,propagateSelect:h,dir:u}=de(l),{handleTypeaheadSearch:C}=_e(),E=we(u),T=M(),K=M(!1),_=fe(),y=te(l,"modelValue",v,{defaultValue:l.defaultValue??(a.value?[]:void 0),passive:l.modelValue===void 0,deep:!0}),n=te(l,"expanded",v,{defaultValue:l.defaultExpanded??[],passive:l.expanded===void 0,deep:!0}),{onSelectItem:d,handleMultipleReplace:e}=Be(y,l),s=B(()=>a.value&&Array.isArray(y.value)?y.value.map(t=>l.getKey(t)):[l.getKey(y.value??{})]);function r(t,f=1,x){return t.reduce((k,I,R)=>{const V=l.getKey(I),D=l.getChildren(I),q=n.value.includes(V),F={_id:V,value:I,index:R,level:f,parentItem:x,hasChildren:!!D,bind:{value:I,level:f,"aria-setsize":t.length,"aria-posinset":R+1}};return k.push(F),D&&q&&k.push(...r(D,f+1,I)),k},[])}const c=B(()=>{const t=l.items;return n.value.map(f=>f),r(t??[])});function m(t){var f;if(K.value)_.trigger(t);else{const x=((f=T.value)==null?void 0:f.getItems())??[];C(t.key,x)}}function b(t){if(K.value)return;const f=Ke[t.key];ve(()=>{var x;e(f,U(),(x=T.value)==null?void 0:x.getItems,c.value.map(k=>k.value))})}return Re({modelValue:y,selectedKeys:s,onSelect:t=>{var k;const f=I=>l.getKey(I??{})===l.getKey(t),x=l.multiple&&Array.isArray(y.value)?((k=y.value)==null?void 0:k.findIndex(f))!==-1:void 0;if(d(t,f),l.propagateSelect&&l.multiple&&Array.isArray(y.value)){const I=j(l.getChildren(t)??[]);x?y.value=[...y.value].filter(R=>!I.some(V=>l.getKey(R??{})===l.getKey(V))):y.value=[...y.value,...I]}},expanded:n,onToggle(t){if(!(t?l.getChildren(t):void 0))return;const x=l.getKey(t)??t;n.value.includes(x)?n.value=n.value.filter(k=>k!==x):n.value.push(x)},getKey:l.getKey,getChildren:l.getChildren,items:S,expandedItems:c,disabled:p,multiple:a,dir:E,propagateSelect:h,isVirtual:K,virtualKeydownHook:_,handleMultipleReplace:e}),(t,f)=>(A(),W(g(Se),{ref_key:"rovingFocusGroupRef",ref:T,"as-child":"",orientation:"vertical",dir:g(E)},{default:$(()=>[L(g(ue),{role:"tree",as:t.as,"as-child":t.asChild,"aria-multiselectable":g(a)?!0:void 0,onKeydown:[m,z(N(b,["shift"]),["up","down"])]},{default:$(()=>[oe(t.$slots,"default",{flattenItems:c.value,modelValue:g(y),expanded:g(n)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),Ve="tree.select",De="tree.toggle",Me=re({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(o,{expose:i,emit:l}){const v=o,S=l,a=Le(),{getItems:p}=pe(),h=B(()=>!!a.getChildren(v.value)),u=B(()=>{const e=a.getKey(v.value);return a.expanded.value.includes(e)}),C=B(()=>{const e=a.getKey(v.value);return a.selectedKeys.value.includes(e)}),E=B(()=>{if(a.propagateSelect.value&&C.value&&h.value&&Array.isArray(a.modelValue.value))return!j(a.getChildren(v.value)||[]).every(s=>a.modelValue.value.find(r=>a.getKey(r)===a.getKey(s)))});function T(e){if(h.value)if(u.value){const s=p().map(t=>t.ref),r=U(),c=s.indexOf(r),b=[...s].slice(c).find(t=>Number(t.getAttribute("data-indent"))===v.level+1);b&&b.focus()}else d(e)}function K(e){if(u.value)d(e);else{const s=p().map(t=>t.ref),r=U(),c=s.indexOf(r),b=[...s].slice(0,c).reverse().find(t=>Number(t.getAttribute("data-indent"))===v.level-1);b&&b.focus()}}async function _(e){S("select",e),!(e!=null&&e.defaultPrevented)&&a.onSelect(v.value)}async function y(e){S("toggle",e),!(e!=null&&e.defaultPrevented)&&a.onToggle(v.value)}async function n(e){if(!e)return;const s={originalEvent:e,value:v.value,isExpanded:u.value,isSelected:C.value};ae(Ve,_,s)}async function d(e){if(!e)return;const s={originalEvent:e,value:v.value,isExpanded:u.value,isSelected:C.value};ae(De,y,s)}return i({isExpanded:u,isSelected:C,isIndeterminate:E,handleToggle:()=>a.onToggle(v.value),handleSelect:()=>a.onSelect(v.value)}),(e,s)=>(A(),W(g(Ae),{"as-child":"",value:e.value,"allow-shift-key":""},{default:$(()=>[L(g(ue),he(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":C.value,"aria-expanded":h.value?u.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":C.value?"":void 0,"data-expanded":u.value?"":void 0,onKeydown:[z(N(n,["self","prevent"]),["enter","space"]),s[0]||(s[0]=z(N(r=>g(a).dir.value==="ltr"?T(r):K(r),["prevent"]),["right"])),s[1]||(s[1]=z(N(r=>g(a).dir.value==="ltr"?K(r):T(r),["prevent"]),["left"]))],onClick:s[2]||(s[2]=N(r=>{n(r),d(r)},["stop"]))}),{default:$(()=>[oe(e.$slots,"default",{isExpanded:u.value,isSelected:C.value,isIndeterminate:E.value,handleSelect:()=>g(a).onSelect(e.value),handleToggle:()=>g(a).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Pe={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},He={__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(o){const i=o,l=me(),v=ge(),[S,a]=Ie(),p=B(()=>{var n,d;return ie({extend:ie(Pe),...((d=(n=v.uiPro)==null?void 0:n.prose)==null?void 0:d.codeTree)||{}})()}),h=M(i.defaultValue?{path:i.defaultValue}:void 0),u=M(),C=M(1),E=B(()=>{var n,d;return C.value,((d=(n=l.default)==null?void 0:n.call(l))==null?void 0:d.flatMap(_).filter(Boolean))||[]}),T=B(()=>K(E.value));function K(n){const d=new Map,e=[];n.forEach(r=>{const c=r.label.split("/");let m="";c.forEach((b,t)=>{var f,x;if(m=m?`${m}/${b}`:b,!d.has(m)){const k={label:b,path:m,...t<c.length-1&&{children:[]}};d.set(m,k),t===0?e.push(k):(x=(f=d.get(c.slice(0,t).join("/")))==null?void 0:f.children)==null||x.push(k)}})});const s=r=>r.sort((c,m)=>!!c.children==!!m.children?c.label.localeCompare(m.label):m.children?1:-1).map(c=>({...c,children:c.children&&s(c.children)}));return s(e)}function _(n,d){var e,s,r,c;return typeof n.type=="symbol"?(e=n.children)==null?void 0:e.map(_):{label:((s=n.props)==null?void 0:s.filename)||((r=n.props)==null?void 0:r.label)||`${d}`,icon:(c=n.props)==null?void 0:c.icon,component:n}}const y=B(()=>{var e;if(i.expandAll){const s=new Set;return E.value.forEach(r=>{const c=r.label.split("/");for(let m=1;m<c.length;m++)s.add(c.slice(0,m).join("/"))}),Array.from(s)}const n=(e=h.value)==null?void 0:e.path;if(!n)return[];const d=n.split("/");return d.map((s,r)=>d.slice(0,r+1).join("/"))});return ye(h,n=>{const d=E.value.find(e=>(n==null?void 0:n.path)===e.label);d!=null&&d.component&&(u.value=d)},{immediate:!0}),be(()=>C.value++),(n,d)=>{var s,r,c,m;const e=Ce;return A(),P(ne,null,[L(g(S),null,{default:$(({items:b,level:t})=>[(A(!0),P(ne,null,ke(b,(f,x)=>{var k,I;return A(),P("li",{key:`${t}-${x}`,class:w(t>0?p.value.itemWithChildren({class:(k=i.ui)==null?void 0:k.itemWithChildren}):p.value.item({class:(I=i.ui)==null?void 0:I.item}))},[L(g(Me),{"as-child":"",level:t,value:f},{default:$(({isExpanded:R,isSelected:V})=>{var D,q,F,H,J,X,Y,Z,Q,ee;return[O("button",{class:w(p.value.link({class:(D=i.ui)==null?void 0:D.link,active:V}))},[(q=f.children)!=null&&q.length?(A(),W(e,{key:0,name:R?g(v).ui.icons.folderOpen:g(v).ui.icons.folder,class:w(p.value.linkLeadingIcon({class:(F=i.ui)==null?void 0:F.linkLeadingIcon}))},null,8,["name","class"])):(A(),W(Ee,{key:1,filename:f.label,class:w(p.value.linkLeadingIcon({class:(H=i.ui)==null?void 0:H.linkLeadingIcon}))},null,8,["filename","class"])),O("span",{class:w(p.value.linkLabel({class:(J=i.ui)==null?void 0:J.linkLabel}))},Te(f.label),3),(X=f.children)!=null&&X.length?(A(),P("span",{key:2,class:w(p.value.linkTrailing({class:(Y=i.ui)==null?void 0:Y.linkTrailing}))},[L(e,{name:g(v).ui.icons.chevronDown,class:w(p.value.linkTrailingIcon({class:(Z=i.ui)==null?void 0:Z.linkTrailingIcon}))},null,8,["name","class"])],2)):se("",!0)],2),(Q=f.children)!=null&&Q.length&&R?(A(),P("ul",{key:0,class:w(p.value.listWithChildren({class:(ee=i.ui)==null?void 0:ee.listWithChildren}))},[L(g(a),{items:f.children,level:t+1},null,8,["items","level"])],2)):se("",!0)]}),_:2},1032,["level","value"])],2)}),128))]),_:1}),O("div",{class:w(p.value.root({class:[(s=i.ui)==null?void 0:s.root,i.class]}))},[L(g($e),{modelValue:h.value,"onUpdate:modelValue":d[0]||(d[0]=b=>h.value=b),class:w(p.value.list({class:(r=i.ui)==null?void 0:r.list})),items:T.value,"get-key":b=>b.path,"default-expanded":y.value},{default:$(()=>[L(g(a),{items:T.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),O("div",{class:w(p.value.content({class:(c=i.ui)==null?void 0:c.content}))},[(A(),W(xe((m=u.value)==null?void 0:m.component)))],2)],2)],64)}}};export{He as default};
